version: '2.1'

services:
    mongodb:
        hostname: mongodb
        container_name: mongodb
        image: bitnami/mongodb:latest
        expose:
          - 27017
        ports:
          - 27017:27017
        volumes:
          - /tmp/data/db:/data/db
        environment:
          - MONGODB_USERNAME=promoManager
          - MONGODB_PASSWORD=password
          - MONGODB_DATABASE=promoManager
          - MONGODB_ROOT_PASSWORD=password
        networks:
          - devit-network

    zookeeper:
      container_name: zookeeper
      hostname: zookeeper
      image: wurstmeister/zookeeper:latest
      ports:
        - 2181:2181
      networks:
        - devit-network

    kafka:
        container_name: kafka
        hostname: kafka
        image: wurstmeister/kafka:latest
        expose:
          - 9092
        ports:
          - 9092:9092
        environment:
#            KAFKA_ADVERTISED_HOST_NAME: localhost
#            KAFKA_ADVERTISED_LISTENERS: localhost:9092
            KAFKA_ADVERTISED_HOST_NAME: kafka
            KAFKA_ADVERTISED_LISTENERS: kafka:9092
            KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
        volumes:
          - /var/run/docker.sock:/var/run/docker.sock
        networks:
          - devit-network

    promo-manager:
        container_name: promo-manager
        hostname: promo-manager
        image: dev-it/promo-manager:latest
        expose:
          - 8081
        ports:
          - 8081:8081
        networks:
          - devit-network
        environment:
          - spring.profiles.active=docker
        links:
          - mongodb:mongodb
        depends_on:
          - mongodb
          - zookeeper
          - kafka
        logging:
            driver: json-file

networks:
    devit-network:
        driver: bridge